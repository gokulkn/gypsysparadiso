<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#050505" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Guest Registration - Gypsys Paradiso</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gold: {
                            400: '#E5C158',
                            500: '#D4AF37',
                            600: '#B59428',
                        },
                        zinc: {
                            850: '#1f1f22',
                            950: '#09090b',
                        },
                        paradiso: {
                            bg: '#050505',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    }
                }
            }
        }
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase Configuration (Already configured from existing file)
        const firebaseConfig = {
            apiKey: "AIzaSyCrW-ZPADSqM7spfNo7LRiorAjLXxTnaOQ",
            authDomain: "paradiso-manager.firebaseapp.com",
            projectId: "paradiso-manager",
            storageBucket: "paradiso-manager.firebasestorage.app",
            messagingSenderId: "732773359834",
            appId: "1:732773359834:web:08d308d3bedee616b305e3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make db available globally
        window.firestoreDB = db;
        window.firestoreAddDoc = addDoc;
        window.firestoreCollection = collection;
    </script>

    <style>
        body {
            overscroll-behavior: none;
        }

        .btn-press:active {
            transform: scale(0.98);
        }
    </style>
</head>

<body class="bg-[#050505] text-[#e5e5e5] overscroll-none">
    <div id="root"></div>

    <script type="module">
        import React, { useState, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { motion, AnimatePresence } from 'https://esm.sh/framer-motion@10.16.4';

        // Simple Signature Pad Component
        const SimpleSignaturePad = ({ onEnd }) => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);

            const startDrawing = (e) => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                ctx.strokeStyle = '#EAB308';
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';

                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;

                ctx.beginPath();
                ctx.moveTo(x, y);
                setIsDrawing(true);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - rect.left;
                const y = (e.clientY || e.touches[0].clientY) - rect.top;

                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const endDrawing = () => {
                setIsDrawing(false);
                if (canvasRef.current) {
                    onEnd(canvasRef.current.toDataURL());
                }
            };

            return React.createElement('canvas', {
                ref: canvasRef,
                width: 300,
                height: 150,
                className: "border border-zinc-700 bg-zinc-900 rounded-xl touch-none w-full",
                onMouseDown: startDrawing,
                onMouseMove: draw,
                onMouseUp: endDrawing,
                onMouseLeave: endDrawing,
                onTouchStart: startDrawing,
                onTouchMove: draw,
                onTouchEnd: endDrawing
            });
        };

        // Main Registration Component
        const GuestRegistration = () => {
            const [step, setStep] = useState(0);
            const [loading, setLoading] = useState(false);
            const [formData, setFormData] = useState({
                fullName: '',
                email: '',
                address: '',
                idProofNumber: '',
                emergencyName: '',
                emergencyPhone: '',
                termsAgreed: false,
                signature: ''
            });
            const [fellowGuests, setFellowGuests] = useState([]);

            // Get booking ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const bookingId = urlParams.get('id');

            const handleNext = () => setStep(p => p + 1);
            const handleBack = () => setStep(p => p - 1);

            const handleSubmit = async () => {
                if (!bookingId) {
                    alert('Invalid booking ID');
                    return;
                }
                setLoading(true);

                try {
                    await window.firestoreAddDoc(window.firestoreCollection(window.firestoreDB, 'registrations'), {
                        bookingId,
                        fullName: formData.fullName,
                        email: formData.email,
                        address: formData.address,
                        idProofNumber: formData.idProofNumber,
                        fellowGuests,
                        emergencyContactName: formData.emergencyName,
                        emergencyContactPhone: formData.emergencyPhone,
                        emergencyRelation: formData.emergencyRelation || '',
                        termsAgreed: formData.termsAgreed,
                        signatureUrl: formData.signature,
                        submittedAt: Date.now()
                    });
                    setStep(5); // Success
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('Failed to submit registration. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            // Success Screen
            if (step === 5) {
                return React.createElement('div', { className: "min-h-screen bg-black flex flex-col items-center justify-center p-6 text-center" },
                    React.createElement(motion.div, {
                        initial: { scale: 0.8, opacity: 0 },
                        animate: { scale: 1, opacity: 1 },
                        className: "w-24 h-24 bg-gold-500 rounded-full flex items-center justify-center mb-6 shadow-[0_0_40px_rgba(234,179,8,0.4)]"
                    },
                        React.createElement('svg', { className: "w-12 h-12 text-black", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
                            React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" })
                        )
                    ),
                    React.createElement('h1', { className: "text-3xl font-serif text-white mb-2" }, "You're All Set!"),
                    React.createElement('p', { className: "text-zinc-400 mb-8 max-w-xs mx-auto" }, "Registration complete. Your Adventure Pass is active."),
                    React.createElement('div', { className: "bg-zinc-900 border border-zinc-800 p-6 rounded-2xl w-full max-w-sm" },
                        React.createElement('p', { className: "text-xs text-zinc-500 uppercase tracking-widest mb-4" }, "SHOW AT RECEPTION"),
                        React.createElement('div', { className: "w-48 h-48 bg-white mx-auto rounded-lg mb-4 flex items-center justify-center" },
                            React.createElement('div', { className: "grid grid-cols-5 gap-1 opacity-80" },
                                [...Array(25)].map((_, i) =>
                                    React.createElement('div', { key: i, className: `w-6 h-6 ${Math.random() > 0.5 ? 'bg-black' : 'bg-transparent'}` })
                                )
                            )
                        ),
                        React.createElement('p', { className: "text-gold-500 font-mono text-lg tracking-widest uppercase" },
                            bookingId?.substring(0, 6) || "ADVENTURE"
                        )
                    )
                );
            }

            // Main Form
            return React.createElement('div', { className: "min-h-screen bg-[#050505] flex flex-col relative overflow-hidden" },
                // Progress Bar
                React.createElement('div', { className: "h-1 bg-zinc-900 w-full fixed top-0 z-50" },
                    React.createElement(motion.div, {
                        className: "h-full bg-gold-500",
                        initial: { width: 0 },
                        animate: { width: `${(step / 4) * 100}%` }
                    })
                ),

                React.createElement('div', { className: "flex-1 flex flex-col p-6 max-w-md mx-auto w-full z-10 pt-12" },
                    // Step 0: Intro
                    step === 0 && React.createElement(motion.div, {
                        initial: { y: 20, opacity: 0 },
                        animate: { y: 0, opacity: 1 },
                        className: "flex-1 flex flex-col justify-center"
                    },
                        React.createElement('span', { className: "text-gold-500 text-xs font-bold uppercase tracking-[0.3em] mb-4" }, "GYPSYS PARADISO"),
                        React.createElement('h1', { className: "text-4xl font-serif text-white mb-6 leading-tight" },
                            "Unlock Your ",
                            React.createElement('br'),
                            React.createElement('span', { className: "text-zinc-500" }, "Adventure.")
                        ),
                        React.createElement('p', { className: "text-zinc-400 text-lg mb-12" },
                            "Welcome. Let's get you checked in so you can head straight to the campfire."
                        ),
                        React.createElement('button', {
                            onClick: handleNext,
                            className: "w-full py-4 bg-white text-black font-bold uppercase tracking-widest rounded-xl hover:bg-zinc-200 transition-colors"
                        }, "Start Check-In")
                    ),

                    // Step 1: Primary Guest
                    step === 1 && React.createElement(motion.div, {
                        initial: { x: 20, opacity: 0 },
                        animate: { x: 0, opacity: 1 },
                        className: "flex-1"
                    },
                        React.createElement('h2', { className: "text-2xl font-serif text-white mb-6" }, "About You"),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('input', {
                                value: formData.fullName,
                                onChange: e => setFormData({ ...formData, fullName: e.target.value }),
                                placeholder: "Full Name",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            }),
                            React.createElement('input', {
                                value: formData.address,
                                onChange: e => setFormData({ ...formData, address: e.target.value }),
                                placeholder: "City / Address",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            }),
                            React.createElement('input', {
                                value: formData.email,
                                onChange: e => setFormData({ ...formData, email: e.target.value }),
                                placeholder: "Email Address",
                                type: "email",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            }),
                            React.createElement('input', {
                                value: formData.idProofNumber,
                                onChange: e => setFormData({ ...formData, idProofNumber: e.target.value }),
                                placeholder: "Aadhaar / ID Number",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            })
                        )
                    ),

                    // Step 2: The Wolfpack
                    step === 2 && React.createElement(motion.div, {
                        initial: { x: 20, opacity: 0 },
                        animate: { x: 0, opacity: 1 },
                        className: "flex-1"
                    },
                        React.createElement('h2', { className: "text-2xl font-serif text-white mb-2" }, "The Wolfpack"),
                        React.createElement('p', { className: "text-zinc-500 text-sm mb-6" }, "Who else is joining the adventure?"),
                        React.createElement('div', { className: "space-y-3 mb-6" },
                            fellowGuests.map((g, i) =>
                                React.createElement('div', { key: i, className: "bg-zinc-800 p-3 rounded-lg flex justify-between items-center" },
                                    React.createElement('span', { className: "text-white" }, g.name),
                                    React.createElement('span', { className: "text-zinc-500 text-xs" }, g.relation)
                                )
                            ),
                            React.createElement('div', { className: "p-4 border border-dashed border-zinc-700 rounded-xl" },
                                React.createElement('input', { id: "newGuestName", placeholder: "Guest Name", className: "bg-transparent text-white w-full mb-2 outline-none" }),
                                React.createElement('div', { className: "flex gap-2" },
                                    React.createElement('input', { id: "newGuestRel", placeholder: "Relation", className: "bg-transparent text-zinc-400 text-sm w-full outline-none" }),
                                    React.createElement('button', {
                                        onClick: () => {
                                            const name = document.getElementById('newGuestName').value;
                                            const rel = document.getElementById('newGuestRel').value;
                                            if (name) {
                                                setFellowGuests([...fellowGuests, { name, relation: rel, age: '' }]);
                                                document.getElementById('newGuestName').value = '';
                                                document.getElementById('newGuestRel').value = '';
                                            }
                                        },
                                        className: "text-gold-500 font-bold text-xs uppercase"
                                    }, "ADD")
                                )
                            )
                        )
                    ),

                    // Step 3: Safety
                    step === 3 && React.createElement(motion.div, {
                        initial: { x: 20, opacity: 0 },
                        animate: { x: 0, opacity: 1 },
                        className: "flex-1"
                    },
                        React.createElement('h2', { className: "text-2xl font-serif text-white mb-6" }, "Safety First"),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('input', {
                                value: formData.emergencyName,
                                onChange: e => setFormData({ ...formData, emergencyName: e.target.value }),
                                placeholder: "Emergency Contact Name",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            }),
                            React.createElement('input', {
                                value: formData.emergencyPhone,
                                onChange: e => setFormData({ ...formData, emergencyPhone: e.target.value }),
                                placeholder: "Emergency Phone",
                                type: "tel",
                                className: "w-full bg-zinc-900/50 border border-zinc-700 p-4 rounded-xl text-white outline-none focus:border-gold-500 transition-colors"
                            })
                        )
                    ),

                    // Step 4: Terms & Sign
                    step === 4 && React.createElement(motion.div, {
                        initial: { x: 20, opacity: 0 },
                        animate: { x: 0, opacity: 1 },
                        className: "flex-1"
                    },
                        React.createElement('h2', { className: "text-2xl font-serif text-white mb-6" }, "The Pact"),
                        React.createElement('div', { className: "bg-zinc-900/50 p-4 rounded-xl mb-6 text-xs text-zinc-400 space-y-2 h-32 overflow-y-auto border border-zinc-700" },
                            React.createElement('p', null, "• I agree to follow campsite rules and respect guests & wildlife."),
                            React.createElement('p', null, "• Open fires purely in designated areas."),
                            React.createElement('p', null, "• Damages to property will incur charges."),
                            React.createElement('p', null, "• Zero tolerance for littering."),
                            React.createElement('p', null, "• Quiet hours after 10 PM.")
                        ),
                        React.createElement('div', { className: "mb-6" },
                            React.createElement('p', { className: "text-zinc-500 text-xs uppercase tracking-wider mb-2" }, "Draw Signature"),
                            React.createElement(SimpleSignaturePad, { onEnd: (url) => setFormData({ ...formData, signature: url, termsAgreed: true }) }),
                            React.createElement('p', { className: "text-[10px] text-zinc-600 mt-2 italic text-center" }, "By signing, you accept all T&C")
                        )
                    ),

                    // Navigation Buttons
                    step > 0 && React.createElement('div', { className: "fixed bottom-0 left-0 right-0 p-4 bg-black/80 backdrop-blur-md border-t border-white/5 z-50 flex gap-4" },
                        React.createElement('button', {
                            onClick: handleBack,
                            className: "px-6 py-4 rounded-xl bg-zinc-900 text-zinc-400 font-bold uppercase tracking-widest text-xs border border-zinc-800"
                        }, "Back"),
                        step < 4
                            ? React.createElement('button', {
                                onClick: handleNext,
                                className: "flex-1 py-4 bg-white text-black font-bold uppercase tracking-widest rounded-xl hover:bg-zinc-200 transition-colors text-xs shadow-lg shadow-white/10"
                            }, "Next Step")
                            : React.createElement('button', {
                                onClick: handleSubmit,
                                disabled: !formData.termsAgreed || loading,
                                className: `flex-1 py-4 font-bold uppercase tracking-widest rounded-xl transition-colors text-xs shadow-lg ${formData.termsAgreed ? 'bg-gold-500 text-black shadow-gold-500/20' : 'bg-zinc-800 text-zinc-500'}`
                            }, loading ? 'Sealing...' : 'Seal the Pact')
                    ),

                    step > 0 && React.createElement('div', { className: "h-24" })
                )
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(GuestRegistration));
    </script>
</body>

</html>